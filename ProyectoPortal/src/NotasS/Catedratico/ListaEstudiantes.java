/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package NotasS.Catedratico;

import Conexion.*;
import Controladores.*;
import NotasS.ClaseListEntregaActiv;
import NotasS.ClaseListEstuSeccion;
import NotasS.ClaseListSecCurso;
import NotasS.ClaseListaPorCurso;
import NotasS.ClasePorSeccCurso_EstuSecc;
import NotasS.ClaseSecCurso_EstSecc_EntAct;
import NotasS.ListaEntregaActiv;
import NotasS.ListaEstuSeccion;
import NotasS.ListaSecCurso;
import NotasS.ListaSecCurso_EstuSec;
import NotasS.ListaSecCurso_EstuSec_EntAct;
import Tablas.*;
import java.beans.PropertyVetoException;
import java.util.Iterator;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.persistence.Query;
import javax.swing.JTable;
import javax.swing.ListSelectionModel;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author Saul
 */
public class ListaEstudiantes extends javax.swing.JInternalFrame {

    
    ListSelectionModel seleccionEst;
    List<ListaSecCurso_EstuSec_EntAct> miListaSecCurs_EstuSec_EntrActi3;
    
    /**
     * Creates new form ListaEstudiantes
     */
    public ListaEstudiantes() {
        initComponents();
        CargarDatos();
        esconderColumna();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        TablaEstudiantes = new javax.swing.JTable();
        jPanel2 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jTextFieldFacultad = new javax.swing.JTextField();
        jTextFieldCarrera = new javax.swing.JTextField();
        jTextFieldCurso = new javax.swing.JTextField();
        jTextFieldSeccion = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        jTextFieldCiclo = new javax.swing.JTextField();
        jTextFieldAnio = new javax.swing.JTextField();

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        TablaEstudiantes.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Nombre", "Apellido", "Carne", "UsuarioEstId"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        TablaEstudiantes.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        seleccionEst = TablaEstudiantes.getSelectionModel();
        seleccionEst.addListSelectionListener(new ListSelectionListener(){
            public void valueChanged(ListSelectionEvent e){
                if(! e.getValueIsAdjusting()){
                    tablaEstudianteSeleccion(TablaEstudiantes);
                }

            }
        });
        jScrollPane1.setViewportView(TablaEstudiantes);
        if (TablaEstudiantes.getColumnModel().getColumnCount() > 0) {
            TablaEstudiantes.getColumnModel().getColumn(0).setResizable(false);
            TablaEstudiantes.getColumnModel().getColumn(1).setResizable(false);
            TablaEstudiantes.getColumnModel().getColumn(2).setResizable(false);
            TablaEstudiantes.getColumnModel().getColumn(3).setResizable(false);
        }

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 1037, Short.MAX_VALUE)
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 370, Short.MAX_VALUE)
                .addContainerGap())
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabel1.setFont(new java.awt.Font("Corbel", 1, 18)); // NOI18N
        jLabel1.setText("LISTA ESTUDIANTES");

        jLabel2.setText("Carrera:");

        jLabel3.setText("Facultad:");

        jLabel4.setText("Seccion:");

        jLabel5.setText("Curso:");

        jLabel6.setText("Ciclo:");

        jLabel7.setText("AÃ±o:");

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addGap(61, 61, 61)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel3)
                    .addComponent(jLabel2))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jTextFieldCarrera, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTextFieldFacultad, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(61, 61, 61)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel4)
                    .addComponent(jLabel5))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jTextFieldSeccion, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTextFieldCurso, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(67, 67, 67)
                        .addComponent(jLabel7))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(65, 65, 65)
                        .addComponent(jLabel6)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jTextFieldAnio, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTextFieldCiclo, javax.swing.GroupLayout.PREFERRED_SIZE, 154, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGap(9, 9, 9)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jTextFieldFacultad, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jTextFieldSeccion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel4)
                            .addComponent(jLabel3)
                            .addComponent(jLabel6)
                            .addComponent(jLabel1))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel2)
                            .addComponent(jLabel5)
                            .addComponent(jTextFieldCarrera, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jTextFieldCurso, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel7)))
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jTextFieldCiclo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jTextFieldAnio, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable TablaEstudiantes;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextField jTextFieldAnio;
    private javax.swing.JTextField jTextFieldCarrera;
    private javax.swing.JTextField jTextFieldCiclo;
    private javax.swing.JTextField jTextFieldCurso;
    private javax.swing.JTextField jTextFieldFacultad;
    private javax.swing.JTextField jTextFieldSeccion;
    // End of variables declaration//GEN-END:variables

    private void CargarDatos() {
        this.jTextFieldCarrera.setEnabled(Boolean.FALSE);
        this.jTextFieldCurso.setEnabled(Boolean.FALSE);
        this.jTextFieldFacultad.setEnabled(Boolean.FALSE);
        this.jTextFieldSeccion.setEnabled(Boolean.FALSE);
        this.jTextFieldCiclo.setEnabled(Boolean.FALSE);
        this.jTextFieldAnio.setEnabled(Boolean.FALSE);
        
        int UsuaCatId = 4;
        int Cursoid = 5;
        int SeccionId = 2;
        ClaseListSecCurso miClaseLisSecCurso = new ClaseListSecCurso();
        List<ListaSecCurso> miListaSecCurso = miClaseLisSecCurso.cargarDatosListSeccionCurso(UsuaCatId);
        ClaseListaPorCurso miListaPorCurso = new ClaseListaPorCurso();
        miListaSecCurso = miListaPorCurso.encontraPorCurso(miListaSecCurso, Cursoid, SeccionId);
   
        ClaseListEstuSeccion miClaseLisEstuSecc = new ClaseListEstuSeccion();
        List<ListaEstuSeccion> miListaEstuSecc = miClaseLisEstuSecc.cargarListaEstudianteSeccion();
        ClasePorSeccCurso_EstuSecc miClasPorSecCur = new ClasePorSeccCurso_EstuSecc();
        miClasPorSecCur.setMiListSeccionCurso(miListaSecCurso);
        miClasPorSecCur.setMiListEstuSeccion(miListaEstuSecc);
        List<ListaSecCurso_EstuSec> miListaSecCurso_EstuSec = miClasPorSecCur.cargarDatosListasSecCurso_EstuSecc();
        
        ClaseListEntregaActiv miClaseLisEntActiv = new ClaseListEntregaActiv();
        List<ListaEntregaActiv> miListaEntAct = miClaseLisEntActiv.cargarDatosListEntregaActividad();
        ClaseSecCurso_EstSecc_EntAct miClaseSecCur_EstuSec_EntrActi = new ClaseSecCurso_EstSecc_EntAct();
        miClaseSecCur_EstuSec_EntrActi.setMiListEntAct(miListaEntAct);
        miClaseSecCur_EstuSec_EntrActi.setMiListSecCur_EstuSecc(miListaSecCurso_EstuSec);
        List<ListaSecCurso_EstuSec_EntAct> miListaSecCurs_EstuSec_EntrActi = miClaseSecCur_EstuSec_EntrActi.cargarDatosSecCur_EstuSuc_EntAct();
        
        miListaSecCurs_EstuSec_EntrActi3 = miListaSecCurs_EstuSec_EntrActi;
        
        DefaultTableModel tablaEstudiantes = (DefaultTableModel) TablaEstudiantes.getModel();
        int cont = 0;
        System.out.println("");
        System.out.println("OTROOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO");
        Iterator<ListaSecCurso_EstuSec_EntAct> iteradorLisSecCur_EstuSec_EntAct = miListaSecCurs_EstuSec_EntrActi.iterator();
        while (iteradorLisSecCur_EstuSec_EntAct.hasNext()) { 
            Boolean bandera = Boolean.FALSE;
            ListaSecCurso_EstuSec_EntAct ListaSecCur_EstSec_EntAct = iteradorLisSecCur_EstuSec_EntAct.next();
            System.out.println(ListaSecCur_EstSec_EntAct);
            
            Query qPerso = ConexionJPA.getInstance("usuario", "usuario").getEm().createNamedQuery("Persona.findById");
            qPerso.setParameter("id", ListaSecCur_EstSec_EntAct.PersonaEstId);
            Persona miPersona = new Persona();
            miPersona = (Persona) qPerso.getSingleResult();
            
            for (int i = 0; i < TablaEstudiantes.getRowCount(); i++) {
                String nombreEst = TablaEstudiantes.getValueAt(i, 0).toString();
                if (ListaSecCur_EstSec_EntAct.getNombreEst() == nombreEst) {
                    bandera = Boolean.TRUE;
                } 
            }
            
            if (bandera == Boolean.FALSE) {
                Object [] datosFila = {ListaSecCur_EstSec_EntAct.getNombreEst(), ListaSecCur_EstSec_EntAct.getApellidoEst(), miPersona.getCarne(), ListaSecCur_EstSec_EntAct.getUsuarioEstId()};
                tablaEstudiantes.addRow(datosFila);
            }
            if (cont == 0) {
                cont++;
                this.jTextFieldAnio.setText("" + ListaSecCur_EstSec_EntAct.getCicloCursoAnio());
                this.jTextFieldCarrera.setText(ListaSecCur_EstSec_EntAct.getCarrera());
                this.jTextFieldCiclo.setText(ListaSecCur_EstSec_EntAct.getCiclo());
                this.jTextFieldCurso.setText(ListaSecCur_EstSec_EntAct.getCurso());
                this.jTextFieldFacultad.setText(ListaSecCur_EstSec_EntAct.getFacultad());
                this.jTextFieldSeccion.setText(ListaSecCur_EstSec_EntAct.getSeccionDescrip());
            }
        }
        
    }
    
    public void tablaEstudianteSeleccion(JTable tablaEst){
        if (tablaEst.getSelectedRow() != -1) {
            
            int filaSelec = TablaEstudiantes.getSelectedRow();
            
            String UsEstId = TablaEstudiantes.getValueAt(filaSelec, 3).toString();
            String carneEst = TablaEstudiantes.getValueAt(filaSelec, 2).toString();
            int usuarioEstId = Integer.parseInt(UsEstId);
            System.out.println(usuarioEstId + " int");
            Estudiante miEstud = new Estudiante(miListaSecCurs_EstuSec_EntrActi3, usuarioEstId, carneEst);
//            Estudiante miEstud = new Estudiante();
            Principal.jDesktopPane1.add(miEstud);
            miEstud.show();
            try {
                miEstud.setMaximum(true);
            } catch (PropertyVetoException ex) {
                Logger.getLogger(Principal.class.getName()).log(Level.SEVERE, null, ex);
            }
            this.dispose();
        }
    }

    private void esconderColumna() {
        TablaEstudiantes.getColumnModel().getColumn(3).setMaxWidth(0);
        TablaEstudiantes.getColumnModel().getColumn(3).setMinWidth(0);
        TablaEstudiantes.getColumnModel().getColumn(3).setPreferredWidth(0);
    }

    
}
